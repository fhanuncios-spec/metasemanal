<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Meta Semanal â€” AlmoÃ§o GrÃ¡tis!</title>
  <style>
    :root{
      /* Dark theme */
      --bg:#06060a;
      --text:#f3f6ff;
      --muted:#a7b0c6;
      --line:rgba(255,255,255,.10);

      /* Accents */
      --primary:#4f8cff;
      --primary2:#a855f7;

      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      /* Category accents */
      --rep:#60a5fa;      /* reparos */
      --dev:#a78bfa;      /* aparelhos */
      --acc:#fbbf24;      /* acessÃ³rios */

      --shadow: 0 16px 40px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 500px at 12% 0%, rgba(79,140,255,.18), transparent 60%),
        radial-gradient(900px 500px at 92% 10%, rgba(168,85,247,.18), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 14px 28px;
    }

    header{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin: 6px 0 14px;
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size: 20px;
      letter-spacing:.2px;
      line-height:1.2;
      color: var(--text);
    }

    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
      white-space:nowrap;
      font-size:13px;
      color: var(--text);
    }

    .pill strong{ color: var(--text); font-weight: 950; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 860px){
      .grid{
        grid-template-columns: 1.15fr .85fr;
        align-items:start;
      }
      h1{ font-size: 22px; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHeader{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(79,140,255,.18), rgba(168,85,247,.10));
    }

    .cardHeader h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
      color: var(--text);
      font-weight: 950;
    }

    .cardHeader p{
      margin:6px 0 0;
      font-size:12px;
      color: rgba(243,246,255,.85);
      line-height:1.35;
    }

    .cardBody{ padding: 14px; }

    /* Top weekly summary */
    .topSummary{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding: 12px;
      margin-bottom: 12px;
    }
    .topSummaryHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .topSummaryHead .t1{
      font-weight: 950;
      letter-spacing:.2px;
    }
    .topSummaryGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .topSummaryGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .chip{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      padding: 10px;
      background: rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    .chip::before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.18;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      pointer-events:none;
    }
    .chip.rep::before{ background: linear-gradient(90deg, var(--rep), rgba(96,165,250,.2)); opacity:.22; }
    .chip.dev::before{ background: linear-gradient(90deg, var(--dev), rgba(167,139,250,.2)); opacity:.22; }
    .chip.acc::before{ background: linear-gradient(90deg, var(--acc), rgba(251,191,36,.2)); opacity:.20; }
    .chip .k{ position:relative; margin:0; font-size:12px; color: var(--muted); }
    .chip .v{ position:relative; margin:6px 0 0; font-size:16px; font-weight: 950; color: var(--text); }
    .chip .s{ position:relative; margin:6px 0 0; font-size:12px; color: rgba(243,246,255,.85); }

    /* Progress */
    .progressTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-end;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .big{
      font-size: 20px;
      font-weight: 950;
      letter-spacing: .2px;
      color: var(--text);
    }
    .small{
      font-size: 12px;
      color: var(--muted);
    }

    .bar{
      height: 14px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      overflow:hidden;
      position:relative;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    .bar > .fill{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      transition: width .35s ease;
    }

    .motivation{
      margin-top: 10px;
      padding: 12px 12px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color: var(--text);
      line-height:1.35;
      font-size: 13px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }

    .badge{
      flex:0 0 auto;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-weight:950;
      color:#0b0f1c;
      background: rgba(255,255,255,.90);
    }
    .badge.good{ background: rgba(34,197,94,.95); color:#07110a; }
    .badge.warn{ background: rgba(245,158,11,.95); color:#120b03; }
    .badge.bad{ background: rgba(239,68,68,.95); color:#140606; }
    .badge.neutral{ background: rgba(79,140,255,.95); color:#050816; }

    /* Collapsible */
    details{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px;
      background: rgba(255,255,255,.04);
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .sumLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .chev{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      display:grid;
      place-items:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 950;
      flex: 0 0 auto;
    }
    details[open] .chev{ transform: rotate(90deg); }
    .sumTitle{
      font-weight: 950;
      color: var(--text);
      font-size: 13px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sumMeta{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      flex: 0 0 auto;
    }
    .panel{
      padding: 12px;
      display:grid;
      gap:10px;
    }

    /* Grids */
    .quickGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .quickGrid{ grid-template-columns: 1fr 1fr 1fr auto; }
    }

    .mixGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .mixGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .mixGrid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .mixGrid2{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .inputs{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .inputs{ grid-template-columns: repeat(3, 1fr); }
    }

    label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size: 12px;
      color: var(--muted);
      min-width: 0;
    }

    input[type="number"]{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(5,8,22,.6);
      color: var(--text);
      outline:none;
      font-size: 14px;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    input[type="number"]:focus{
      border-color: rgba(79,140,255,.65);
      box-shadow: 0 0 0 4px rgba(79,140,255,.18);
    }

    .stats{
      display:grid;
      gap:10px;
    }

    .statGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .statGrid{ grid-template-columns: 1fr 1fr; }
    }

    .stat{
      padding: 12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .stat .k{
      margin:0;
      font-size:12px;
      color: var(--muted);
    }
    .stat .v{
      margin:6px 0 0;
      font-size:18px;
      font-weight: 950;
      letter-spacing: .2px;
      color: var(--text);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 950;
      font-size: 13px;
      letter-spacing: .2px;
      cursor:pointer;
      width:100%;
    }
    @media (min-width: 520px){
      button{ width:auto; }
    }
    button:active{ transform: translateY(1px); }
    .btnPrimary{
      border-color: rgba(79,140,255,.35);
      background: linear-gradient(180deg, rgba(79,140,255,.22), rgba(79,140,255,.10));
    }
    .btnDanger{
      border-color: rgba(239,68,68,.30);
      background: linear-gradient(180deg, rgba(239,68,68,.22), rgba(239,68,68,.10));
    }

    .footerNote{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.35;
    }

    .historyHead{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .historyHead .left{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .historyHead .left strong{ color: var(--text); }
    .historyList{
      display:grid;
      gap:10px;
    }
    .weekItem{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      display:grid;
      gap:8px;
    }
    .weekTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .weekTop .wtitle{
      font-weight: 950;
      color: var(--text);
      letter-spacing:.2px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      font-size:12px;
      font-weight: 950;
      white-space:nowrap;
      background: rgba(255,255,255,.05);
    }
    .tag.good{ background: rgba(34,197,94,.14); color: #7CFFB1; border-color: rgba(34,197,94,.30); }
    .tag.bad{ background: rgba(239,68,68,.12); color: #FF9AA7; border-color: rgba(239,68,68,.28); }

    .weekGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    @media (min-width: 520px){
      .weekGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .mini{
      border:1px dashed rgba(255,255,255,.16);
      border-radius: 14px;
      padding: 10px;
      background: rgba(0,0,0,.20);
    }
    .mini .k{ margin:0; font-size:11px; color: var(--muted); }
    .mini .v{ margin:6px 0 0; font-size:14px; font-weight: 950; color: var(--text); }

    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      max-width: min(560px, calc(100% - 24px));
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,14,25,.88);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 50;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="titleRow">
        <div>
          <h1>Meta Semanal (Segâ€“SÃ¡b) â€” AlmoÃ§o grÃ¡tis se bater! ğŸ½ï¸ğŸ”¥</h1>
          <p class="subtitle">
            Agora com <strong>Resumo no topo</strong> + <strong>Estimativa do que vender</strong> para bater a meta. âœ…
          </p>
        </div>
        <div class="pill" aria-label="Meta semanal">
          ğŸ¯ <span>Meta: <strong id="goalLabel">R$ 12.000,00</strong></span>
        </div>
      </div>
    </header>

    <section class="grid">
      <!-- Main -->
      <div class="card">
        <div class="cardHeader">
          <div>
            <h2>Semana atual</h2>
            <p>Progresso + lanÃ§amentos (salva automaticamente no navegador). ğŸ“ˆ</p>
          </div>
          <div class="pill">ğŸ“… <strong id="weekLabel">Semana</strong></div>
        </div>

        <div class="cardBody">
          <!-- RESUMO NO TOPO -->
          <div class="topSummary" aria-label="Resumo da semana no topo">
            <div class="topSummaryHead">
              <div>
                <div class="t1">ğŸ“Œ Resumo da semana (atÃ© agora)</div>
                <div class="subtitle" style="margin-top:4px;">Reparos ğŸ”§ â€¢ Aparelhos ğŸ“± â€¢ AcessÃ³rios ğŸ§</div>
              </div>
              <div class="pill">âš¡ <span>Progresso: <strong id="topPct">0%</strong></span></div>
            </div>
            <div class="topSummaryGrid">
              <div class="chip rep">
                <p class="k">ğŸ”§ Reparos</p>
                <p class="v" id="topRep">R$ 0,00</p>
                <p class="s" id="topRepS">â€”</p>
              </div>
              <div class="chip dev">
                <p class="k">ğŸ“± Aparelhos</p>
                <p class="v" id="topDev">R$ 0,00</p>
                <p class="s" id="topDevS">Lucro estimado/unidade: <strong id="topProfitUnit">R$ 400,00</strong></p>
              </div>
              <div class="chip acc">
                <p class="k">ğŸ§ AcessÃ³rios</p>
                <p class="v" id="topAcc">R$ 0,00</p>
                <p class="s" id="topAccS">â€”</p>
              </div>
            </div>
          </div>

          <div class="progressTop">
            <div>
              <div class="big" id="totalLabel">R$ 0,00</div>
              <div class="small">
                <span id="pctLabel">0%</span> â€¢ Falta <span id="remainingLabel">R$ 12.000,00</span>
              </div>
            </div>
            <div class="pill">ğŸ† AlmoÃ§o grÃ¡tis ao atingir <strong>100%</strong></div>
          </div>

          <div class="bar" aria-label="Barra de progresso">
            <div class="fill" id="barFill"></div>
          </div>

          <div class="motivation" role="status" aria-live="polite">
            <div class="badge neutral" id="motivationBadge">âš¡</div>
            <div>
              <div style="font-weight:950; margin-bottom:4px;" id="motivationTitle">Vamo pra cima! ğŸ’¥</div>
              <div id="motivationText">Hoje Ã© dia de executar sem desculpa: atendimento afiado, oferta na mesa e fechamento no caixa. O almoÃ§o grÃ¡tis Ã© NOSSO! ğŸ½ï¸ğŸ”¥</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <!-- ESTIMATIVA (FECHADO por padrÃ£o) -->
          <details id="estimateDetails">
            <summary>
              <div class="sumLeft">
                <div class="chev">â€º</div>
                <div class="sumTitle">Estimativa: quanto vender para bater a meta ğŸ§ ğŸ“Œ</div>
              </div>
              <div class="sumMeta" id="estimateMeta">Fechado</div>
            </summary>

            <div class="panel">
              <div class="subtitle" style="margin:0;">
                Configure o â€œpesoâ€ (mix) de cada categoria na meta semanal. Por padrÃ£o: <strong>Reparos maior</strong>, <strong>Aparelhos segundo</strong> (lucro ~ R$ 400/un),
                <strong>AcessÃ³rios menor</strong>. Ajuste como quiser. âœ…
              </div>

              <div class="mixGrid">
                <label>
                  % Reparos (maior) ğŸ”§
                  <input id="mixRep" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 60" />
                </label>
                <label>
                  % Aparelhos (2Âº maior) ğŸ“±
                  <input id="mixDev" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 30" />
                </label>
                <label>
                  % AcessÃ³rios (menor) ğŸ§
                  <input id="mixAcc" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 10" />
                </label>
              </div>

              <div class="mixGrid2">
                <label>
                  Ticket mÃ©dio por reparo (R$) ğŸ”§
                  <input id="avgRepair" type="number" inputmode="decimal" min="1" step="1" placeholder="Ex: 250" />
                </label>
                <label>
                  Lucro por aparelho (R$) ğŸ“±
                  <input id="profitDevice" type="number" inputmode="decimal" min="1" step="1" placeholder="400" />
                </label>
                <label>
                  Ticket mÃ©dio por acessÃ³rio (R$) ğŸ§
                  <input id="avgAccessory" type="number" inputmode="decimal" min="1" step="1" placeholder="Ex: 50" />
                </label>
              </div>

              <div class="topSummary" style="margin:0;">
                <div class="topSummaryHead" style="margin-bottom:8px;">
                  <div class="t1">ğŸ¯ NecessÃ¡rio na semana (estimado)</div>
                  <div class="pill">Î£ <strong id="mixTotalPct">100%</strong></div>
                </div>

                <div class="topSummaryGrid">
                  <div class="chip rep">
                    <p class="k">ğŸ”§ Reparos</p>
                    <p class="v" id="needRepMoney">R$ 0,00</p>
                    <p class="s" id="needRepUnits">â‰ˆ 0 reparos/semana</p>
                  </div>
                  <div class="chip dev">
                    <p class="k">ğŸ“± Aparelhos (lucro)</p>
                    <p class="v" id="needDevMoney">R$ 0,00</p>
                    <p class="s" id="needDevUnits">â‰ˆ 0 aparelhos/semana</p>
                  </div>
                  <div class="chip acc">
                    <p class="k">ğŸ§ AcessÃ³rios</p>
                    <p class="v" id="needAccMoney">R$ 0,00</p>
                    <p class="s" id="needAccUnits">â‰ˆ 0 acessÃ³rios/semana</p>
                  </div>
                </div>

                <div class="subtitle" style="margin-top:10px;">
                  ğŸ’¡ Dica: se o total das % nÃ£o der 100%, eu <strong>normalizo automaticamente</strong> (divido proporcionalmente).
                </div>
              </div>
            </div>
          </details>

          <div style="height:12px"></div>

          <!-- Entrada rÃ¡pida (FECHADO por padrÃ£o) -->
          <details id="quickDetails">
            <summary>
              <div class="sumLeft">
                <div class="chev">â€º</div>
                <div class="sumTitle">Entrada rÃ¡pida: lanÃ§ar TOTAL da semana por categoria ğŸ§¾</div>
              </div>
              <div class="sumMeta" id="quickMeta">Fechado</div>
            </summary>
            <div class="panel">
              <div class="subtitle" style="margin:0;">
                Se vocÃª sÃ³ tem o total no Ãºltimo dia, preencha os 3 valores (um por categoria) e aplique.
                Isso vai preencher tudo no <strong>SÃ¡bado</strong> (como â€œfechamentoâ€ da semana). âœ…
              </div>

              <div class="quickGrid">
                <label>
                  Consertos (R$) ğŸ”§
                  <input id="qConsertos" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <label>
                  AcessÃ³rios (R$) ğŸ§
                  <input id="qAcessorios" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <label>
                  Venda de Aparelhos (R$) ğŸ“±
                  <input id="qAparelhos" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <button class="btnPrimary" id="applyQuickBtn">Aplicar ğŸš€</button>
              </div>

              <div class="subtitle" style="margin:0;">
                Dica: quer lanÃ§ar um total Ãºnico? Preencha sÃ³ uma categoria e deixe as outras em 0. ğŸ¯
              </div>
            </div>
          </details>

          <div style="height:12px"></div>

          <!-- Dias (todos FECHADOS por padrÃ£o) -->
          <div id="daysBox" style="display:grid; gap:10px;"></div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="card">
        <div class="cardHeader">
          <div>
            <h2>Resumo & HistÃ³rico</h2>
            <p>Categoria, mÃ©dias e semanas anteriores. ğŸ—‚ï¸</p>
          </div>
        </div>

        <div class="cardBody">
          <div class="stats">
            <div class="statGrid">
              <div class="stat">
                <p class="k">Consertos ğŸ”§</p>
                <p class="v" id="sumConsertos">R$ 0,00</p>
              </div>
              <div class="stat">
                <p class="k">AcessÃ³rios ğŸ§</p>
                <p class="v" id="sumAcessorios">R$ 0,00</p>
              </div>
              <div class="stat" style="grid-column: 1 / -1;">
                <p class="k">Venda de Aparelhos ğŸ“±</p>
                <p class="v" id="sumAparelhos">R$ 0,00</p>
              </div>
            </div>

            <div class="stat">
              <p class="k">MÃ©dia por dia (dias preenchidos) ğŸ“Š</p>
              <p class="v" id="avgPerDay">R$ 0,00</p>
              <p class="k" style="margin-top:8px;">Ritmo necessÃ¡rio (mÃ©dia/dia para bater) â±ï¸</p>
              <p class="v" id="neededPerDay">R$ 0,00</p>
            </div>

            <div class="actions">
              <button class="btnPrimary" id="closeWeekBtn">Fechar semana e salvar no histÃ³rico ğŸ</button>
              <button class="btnDanger" id="resetBtn">Zerar semana atual ğŸ§¨</button>
            </div>

            <div class="historyHead">
              <div class="left">
                <strong>HistÃ³rico</strong>
                <span class="subtitle" style="margin:0;">Semanas fechadas (Semana 1, 2, 3...)</span>
              </div>
              <button class="btnDanger" id="clearHistoryBtn" style="width:auto;">Limpar histÃ³rico ğŸ—‘ï¸</button>
            </div>

            <div class="historyList" id="historyList"></div>

            <p class="footerNote">
              âœ… Tudo fica salvo neste navegador (sem servidor). <br/>
              ğŸ“Œ â€œFechar semanaâ€ salva a Semana atual no histÃ³rico e inicia uma nova semana em branco.
            </p>
          </div>
        </div>
      </aside>
    </section>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Config =====
    const GOAL = 12000;

    const DAYS = [
      { key: "seg", label: "Segunda" },
      { key: "ter", label: "TerÃ§a" },
      { key: "qua", label: "Quarta" },
      { key: "qui", label: "Quinta" },
      { key: "sex", label: "Sexta" },
      { key: "sab", label: "SÃ¡bado" },
    ];

    const CATS = [
      { key: "consertos", label: "Consertos" },
      { key: "acessorios", label: "AcessÃ³rios" },
      { key: "aparelhos", label: "Venda de aparelhos" },
    ];

    const STORAGE_KEY = "meta_semanal_v5_dark_estimate_fixed"; // âœ… nova chave p/ evitar conflito

    // ===== Helpers =====
    const brl = (n) =>
      new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(n || 0);

    function clamp(n, min, max){ return Math.min(Math.max(n, min), max); }
    function safeNumber(v){ const n = Number(v); return Number.isFinite(n) ? Math.max(0, n) : 0; }
    function safePositive(v, fallback){ const n = Number(v); return (Number.isFinite(n) && n > 0) ? n : fallback; }

    // âœ… Anti-crash helpers (resolve seu erro do F12)
    function $(id){ return document.getElementById(id); }
    function setText(id, value){
      const el = $(id);
      if(!el) return false;
      el.textContent = value;
      return true;
    }
    function setHTML(id, value){
      const el = $(id);
      if(!el) return false;
      el.innerHTML = value;
      return true;
    }

    function getWeekLabel(){
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,"0");
      const mm = String(now.getMonth()+1).padStart(2,"0");
      return `Semana de ${dd}/${mm}`;
    }

    function showToast(msg){
      const el = $("toast");
      el.textContent = msg;
      el.classList.add("show");
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(()=> el.classList.remove("show"), 2200);
    }

    function sumWeekData(data){
      let total = 0;
      const perCat = { consertos:0, acessorios:0, aparelhos:0 };
      const perDay = {};
      for (const d of DAYS){
        let dayTotal = 0;
        for (const c of CATS){
          const v = safeNumber(data?.[d.key]?.[c.key] ?? 0);
          dayTotal += v;
          perCat[c.key] += v;
        }
        perDay[d.key] = dayTotal;
        total += dayTotal;
      }
      return { total, perCat, perDay };
    }

    // ===== State =====
    function blankWeekData(){
      const data = {};
      for (const d of DAYS){
        data[d.key] = {};
        for (const c of CATS) data[d.key][c.key] = 0;
      }
      return data;
    }

    function defaultState(){
      return {
        weekNumber: 1,
        current: { data: blankWeekData() },
        history: [],
        estimate: {
          mixRep: 60,
          mixDev: 30,
          mixAcc: 10,
          avgRepair: 250,
          profitDevice: 400,
          avgAccessory: 50
        }
      };
    }

    function migrate(obj){
      const base = defaultState();
      if(!obj || typeof obj !== "object") return base;

      obj.weekNumber = safeNumber(obj.weekNumber ?? 1) || 1;
      obj.current = obj.current || base.current;
      obj.current.data = obj.current.data || blankWeekData();

      for (const d of DAYS){
        obj.current.data[d.key] = obj.current.data[d.key] || {};
        for (const c of CATS){
          obj.current.data[d.key][c.key] = safeNumber(obj.current.data?.[d.key]?.[c.key] ?? 0);
        }
      }

      obj.history = Array.isArray(obj.history) ? obj.history : [];
      obj.estimate = obj.estimate || base.estimate;

      obj.estimate.mixRep = safeNumber(obj.estimate.mixRep ?? base.estimate.mixRep);
      obj.estimate.mixDev = safeNumber(obj.estimate.mixDev ?? base.estimate.mixDev);
      obj.estimate.mixAcc = safeNumber(obj.estimate.mixAcc ?? base.estimate.mixAcc);
      obj.estimate.avgRepair = safeNumber(obj.estimate.avgRepair ?? base.estimate.avgRepair);
      obj.estimate.profitDevice = safeNumber(obj.estimate.profitDevice ?? base.estimate.profitDevice);
      obj.estimate.avgAccessory = safeNumber(obj.estimate.avgAccessory ?? base.estimate.avgAccessory);

      return obj;
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        return migrate(JSON.parse(raw));
      }catch{
        return defaultState();
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    // ===== Motivation =====
    function motivationFor(pct, remaining){
      const base = {
        badgeClass: "neutral",
        badge: "âš¡",
        title: "Vamo pra cima! ğŸ’¥",
        text: "Atendimento afiado + proposta na mesa + fechamento no caixa. O almoÃ§o grÃ¡tis Ã© NOSSO! ğŸ½ï¸ğŸ”¥"
      };

      if (pct >= 100) return { badgeClass:"good", badge:"ğŸ†", title:"META BATIDA!!! Ã‰ CAMPEÃƒO! ğŸ‰ğŸ½ï¸",
        text:"TIME BRABO! Foi na raÃ§a e na consistÃªncia. Agora Ã© comemorar: almoÃ§o grÃ¡tis garantido! ğŸš€ğŸ”¥ğŸ¥³" };
      if (pct >= 90) return { badgeClass:"good", badge:"ğŸš¨", title:"FALTAM MIGALHAS! ÃšLTIMO ATAQUE! ğŸš€",
        text:`Falta sÃ³ ${brl(remaining)}. Sem freio agora: puxa oferta, fecha combo e garante a vitÃ³ria! ğŸ¥ŠğŸ”¥` };
      if (pct >= 75) return { badgeClass:"neutral", badge:"ğŸš€", title:"RETA FINAL â€” MANTÃ‰M A PRESSÃƒO! ğŸ’ª",
        text:`Falta ${brl(remaining)}. NÃ£o tira o pÃ©: constÃ¢ncia + fechamento = almoÃ§o na mesa! ğŸ½ï¸âš¡` };
      if (pct >= 50) return { badgeClass:"neutral", badge:"ğŸ’¥", title:"META NO RADAR â€” AGORA ACELERA! ğŸï¸",
        text:`Falta ${brl(remaining)}. Bora subir ticket mÃ©dio e fechar sem deixar cliente â€œpra depoisâ€! ğŸ”¥ğŸ“ˆ` };
      if (pct >= 25) return { badgeClass:"neutral", badge:"âœ…", title:"COMEÃ‡O FORTE â€” CONTINUA NO RITMO! ğŸ¯",
        text:`Falta ${brl(remaining)}. Um dia bom puxa o outro â€” vamos empilhar resultado! ğŸ§±ğŸ”¥` };
      if (pct > 0) return { badgeClass:"neutral", badge:"ğŸ§ ", title:"RITMO Ã‰ TUDO â€” COMEÃ‡A AGORA! â±ï¸",
        text:`Falta ${brl(remaining)}. Foco no prÃ³ximo cliente e no prÃ³ximo fechamento! ğŸ’ªâœ¨` };

      return base;
    }

    // ===== UI build (Days) =====
    const daysBox = $("daysBox");

    function buildDays(){
      daysBox.innerHTML = "";
      for (const d of DAYS){
        const det = document.createElement("details");
        det.id = `day_${d.key}`;

        const sum = document.createElement("summary");
        sum.innerHTML = `
          <div class="sumLeft">
            <div class="chev">â€º</div>
            <div class="sumTitle">${d.label} ğŸ“Œ</div>
          </div>
          <div class="sumMeta" id="meta_${d.key}">Total: ${brl(0)}</div>
        `;

        const panel = document.createElement("div");
        panel.className = "panel";

        const inputs = document.createElement("div");
        inputs.className = "inputs";

        for (const c of CATS){
          const lab = document.createElement("label");
          const emoji = c.key === "consertos" ? "ğŸ”§" : (c.key === "acessorios" ? "ğŸ§" : "ğŸ“±");
          lab.textContent = `${c.label} ${emoji}`;

          const inp = document.createElement("input");
          inp.type = "number";
          inp.inputMode = "decimal";
          inp.min = "0";
          inp.step = "0.01";
          inp.placeholder = "0,00";
          inp.value = String(state.current.data[d.key][c.key] ?? 0);

          inp.addEventListener("input", () => {
            state.current.data[d.key][c.key] = safeNumber(inp.value);
            saveState();
            render();
          });

          lab.appendChild(inp);
          inputs.appendChild(lab);
        }

        panel.appendChild(inputs);
        det.appendChild(sum);
        det.appendChild(panel);
        daysBox.appendChild(det);
      }
    }

    function syncDayInputs(){
      for (const d of DAYS){
        const det = $(`day_${d.key}`);
        if(!det) continue;
        const inputs = det.querySelectorAll('input[type="number"]');
        inputs.forEach((inp, idx)=>{
          const catKey = CATS[idx]?.key;
          if(!catKey) return;
          inp.value = String(safeNumber(state.current.data[d.key][catKey]));
        });
      }
    }

    // ===== Quick + Estimate details meta =====
    const quickDetails = $("quickDetails");
    const quickMeta = $("quickMeta");
    quickDetails.addEventListener("toggle", () => {
      quickMeta.textContent = quickDetails.open ? "Aberto" : "Fechado";
    });

    const estimateDetails = $("estimateDetails");
    const estimateMeta = $("estimateMeta");
    estimateDetails.addEventListener("toggle", () => {
      estimateMeta.textContent = estimateDetails.open ? "Aberto" : "Fechado";
    });

    // ===== Quick action =====
    $("applyQuickBtn").addEventListener("click", () => {
      const vC = safeNumber($("qConsertos").value);
      const vA = safeNumber($("qAcessorios").value);
      const vP = safeNumber($("qAparelhos").value);
      const total = vC + vA + vP;

      if(total <= 0){
        showToast("Preencha pelo menos uma categoria. âš ï¸");
        return;
      }

      state.current.data = blankWeekData();
      const targetDay = "sab";
      state.current.data[targetDay].consertos = vC;
      state.current.data[targetDay].acessorios = vA;
      state.current.data[targetDay].aparelhos  = vP;

      saveState();
      syncDayInputs();
      render();
      showToast("Totais aplicados na semana âœ…ğŸš€");
    });

    // ===== Estimate inputs (persist) =====
    const mixRepEl = $("mixRep");
    const mixDevEl = $("mixDev");
    const mixAccEl = $("mixAcc");
    const avgRepairEl = $("avgRepair");
    const profitDeviceEl = $("profitDevice");
    const avgAccessoryEl = $("avgAccessory");

    function hydrateEstimateInputs(){
      mixRepEl.value = String(state.estimate.mixRep ?? 60);
      mixDevEl.value = String(state.estimate.mixDev ?? 30);
      mixAccEl.value = String(state.estimate.mixAcc ?? 10);
      avgRepairEl.value = String(state.estimate.avgRepair ?? 250);
      profitDeviceEl.value = String(state.estimate.profitDevice ?? 400);
      avgAccessoryEl.value = String(state.estimate.avgAccessory ?? 50);
      setText("topProfitUnit", brl(safePositive(state.estimate.profitDevice, 400)));
    }

    function saveEstimateFromInputs(){
      state.estimate.mixRep = safeNumber(mixRepEl.value);
      state.estimate.mixDev = safeNumber(mixDevEl.value);
      state.estimate.mixAcc = safeNumber(mixAccEl.value);
      state.estimate.avgRepair = safeNumber(avgRepairEl.value);
      state.estimate.profitDevice = safeNumber(profitDeviceEl.value);
      state.estimate.avgAccessory = safeNumber(avgAccessoryEl.value);
      saveState();
      renderEstimate();
      renderTopSummary();
    }

    [mixRepEl, mixDevEl, mixAccEl, avgRepairEl, profitDeviceEl, avgAccessoryEl].forEach(el=>{
      el.addEventListener("input", saveEstimateFromInputs);
    });

    function normalizedMix(){
      let r = safeNumber(state.estimate.mixRep);
      let d = safeNumber(state.estimate.mixDev);
      let a = safeNumber(state.estimate.mixAcc);
      const sum = r + d + a;

      if(sum <= 0){
        return { r:60, d:30, a:10 };
      }
      const rr = (r / sum) * 100;
      const dd = (d / sum) * 100;
      const aa = 100 - rr - dd;
      return { r: rr, d: dd, a: aa };
    }

    function renderEstimate(){
      const mix = normalizedMix();

      const avgRepair = safePositive(state.estimate.avgRepair, 250);
      const profitDevice = safePositive(state.estimate.profitDevice, 400);
      const avgAccessory = safePositive(state.estimate.avgAccessory, 50);

      const needRepMoney = GOAL * (mix.r/100);
      const needDevMoney = GOAL * (mix.d/100);
      const needAccMoney = GOAL * (mix.a/100);

      const repUnits = Math.ceil(needRepMoney / avgRepair);
      const devUnits = Math.ceil(needDevMoney / profitDevice);
      const accUnits = Math.ceil(needAccMoney / avgAccessory);

      setText("mixTotalPct", "100%");
      setText("needRepMoney", brl(needRepMoney));
      setText("needDevMoney", brl(needDevMoney));
      setText("needAccMoney", brl(needAccMoney));

      setText("needRepUnits", `â‰ˆ ${repUnits} reparos/semana (ticket ~ ${brl(avgRepair)})`);
      setText("needDevUnits", `â‰ˆ ${devUnits} aparelhos/semana (lucro ~ ${brl(profitDevice)}/un)`);
      setText("needAccUnits", `â‰ˆ ${accUnits} acessÃ³rios/semana (ticket ~ ${brl(avgAccessory)})`);

      setText("topProfitUnit", brl(profitDevice));
    }

    // âœ… FIX: renderTopSummary NÃƒO quebra mais (resolve seu erro do F12)
    function renderTopSummary(){
      const { total, perCat } = sumWeekData(state.current.data);
      const pct = clamp((total / GOAL) * 100, 0, 999);

      setText("topPct", `${Math.floor(pct)}%`);
      setText("topRep", brl(perCat.consertos));
      setText("topDev", brl(perCat.aparelhos));
      setText("topAcc", brl(perCat.acessorios));

      const remaining = Math.max(0, GOAL - total);

      setText("topRepS", "ğŸ¯ Reparos puxam a meta â€” mantÃ©m o ticket mÃ©dio alto!");
      setText("topAccS", "âš¡ AcessÃ³rios: upsell no balcÃ£o (â€œjÃ¡ leva junto?â€)");

      const profitDevice = safePositive(state.estimate?.profitDevice, 400);
      setText("topProfitUnit", brl(profitDevice));

      const approxDevicesToGoal = Math.ceil(remaining / profitDevice);

      if (remaining > 0) {
        setHTML(
          "topDevS",
          `Lucro/un: <strong>${brl(profitDevice)}</strong> â€¢ Para cobrir o restante sÃ³ com aparelhos: <strong>~${approxDevicesToGoal}</strong> ğŸ“±`
        );
      } else {
        setHTML(
          "topDevS",
          `Lucro/un: <strong>${brl(profitDevice)}</strong> â€¢ Meta batida! ğŸ†`
        );
      }
    }

    // ===== History =====
    function renderHistory(){
      const box = $("historyList");
      box.innerHTML = "";

      if (!state.history.length){
        const empty = document.createElement("div");
        empty.className = "weekItem";
        empty.innerHTML = `
          <div class="weekTop">
            <div class="wtitle">Nenhuma semana fechada ainda ğŸ—‚ï¸</div>
            <span class="tag bad">HistÃ³rico vazio</span>
          </div>
          <div style="color: var(--muted); font-size: 12px; line-height:1.35;">
            Feche a semana para salvar no histÃ³rico como Semana 1, Semana 2, etc. âœ…
          </div>
        `;
        box.appendChild(empty);
        return;
      }

      const items = [...state.history].sort((a,b)=> b.weekNumber - a.weekNumber);

      for (const item of items){
        const pct = clamp((item.total / item.goal) * 100, 0, 999);
        const hit = item.total >= item.goal;

        const el = document.createElement("div");
        el.className = "weekItem";

        const date = item.closedAt ? new Date(item.closedAt) : null;
        const dateLabel = date ? date.toLocaleString("pt-BR") : "-";

        el.innerHTML = `
          <div class="weekTop">
            <div>
              <div class="wtitle">Semana ${item.weekNumber}</div>
              <div style="color: var(--muted); font-size: 12px; margin-top:2px;">
                Fechada em: ${dateLabel}
              </div>
            </div>
            <span class="tag ${hit ? "good" : "bad"}">
              ${hit ? "Meta batida âœ…" : "NÃ£o bateu âŒ"} â€¢ ${Math.floor(pct)}%
            </span>
          </div>

          <div class="weekGrid">
            <div class="mini">
              <p class="k">Total</p>
              <p class="v">${brl(item.total)}</p>
            </div>
            <div class="mini">
              <p class="k">Meta</p>
              <p class="v">${brl(item.goal)}</p>
            </div>
            <div class="mini">
              <p class="k">Faltou / Sobrou</p>
              <p class="v">${hit ? brl(item.total - item.goal) : brl(item.goal - item.total)}</p>
            </div>
            <div class="mini">
              <p class="k">Consertos ğŸ”§</p>
              <p class="v">${brl(item.perCat.consertos)}</p>
            </div>
            <div class="mini">
              <p class="k">AcessÃ³rios ğŸ§</p>
              <p class="v">${brl(item.perCat.acessorios)}</p>
            </div>
            <div class="mini">
              <p class="k">Aparelhos ğŸ“±</p>
              <p class="v">${brl(item.perCat.aparelhos)}</p>
            </div>
          </div>
        `;
        box.appendChild(el);
      }
    }

    // ===== Render =====
    function render(){
      const { total, perCat, perDay } = sumWeekData(state.current.data);
      const pct = clamp((total / GOAL) * 100, 0, 999);
      const pctShown = Math.floor(pct);
      const remaining = Math.max(0, GOAL - total);

      setText("totalLabel", brl(total));
      setText("pctLabel", `${pctShown}%`);
      setText("remainingLabel", brl(remaining));
      $("barFill").style.width = `${clamp(pct, 0, 100)}%`;

      setText("sumConsertos", brl(perCat.consertos));
      setText("sumAcessorios", brl(perCat.acessorios));
      setText("sumAparelhos", brl(perCat.aparelhos));

      const daysWithAny = DAYS.reduce((acc,d)=> acc + (perDay[d.key] > 0 ? 1 : 0), 0);
      const avg = daysWithAny > 0 ? total / daysWithAny : 0;
      setText("avgPerDay", brl(avg));

      const daysRemaining = Math.max(0, DAYS.length - daysWithAny);
      const needed = daysRemaining > 0 ? remaining / daysRemaining : remaining;
      setText("neededPerDay", brl(needed));

      for (const d of DAYS){
        const meta = $(`meta_${d.key}`);
        if(meta) meta.textContent = "Total: " + brl(perDay[d.key]);
      }

      const mot = motivationFor(pct, remaining);
      const badge = $("motivationBadge");
      badge.className = `badge ${mot.badgeClass}`;
      badge.textContent = mot.badge;
      setText("motivationTitle", mot.title);
      setText("motivationText", mot.text);

      setText("weekLabel", getWeekLabel() + ` â€¢ Semana ${state.weekNumber}`);
      setText("goalLabel", brl(GOAL));

      renderTopSummary();
      renderEstimate();
      renderHistory();
    }

    // ===== Actions =====
    $("resetBtn").addEventListener("click", () => {
      state.current.data = blankWeekData();
      saveState();
      syncDayInputs();
      render();
      showToast("Semana atual zerada âœ…");
    });

    $("closeWeekBtn").addEventListener("click", () => {
      const { total, perCat } = sumWeekData(state.current.data);

      state.history.push({
        weekNumber: state.weekNumber,
        closedAt: new Date().toISOString(),
        goal: GOAL,
        total,
        perCat
      });

      state.weekNumber += 1;
      state.current.data = blankWeekData();

      $("qConsertos").value = "";
      $("qAcessorios").value = "";
      $("qAparelhos").value = "";

      saveState();
      syncDayInputs();
      render();

      showToast(total >= GOAL ? "META BATIDA! Semana salva ğŸ†ğŸ”¥" : "Semana salva â€” volta mais forte! ğŸ’ªâš¡");
    });

    $("clearHistoryBtn").addEventListener("click", () => {
      state.history = [];
      saveState();
      render();
      showToast("HistÃ³rico limpo âœ…ğŸ—‘ï¸");
    });

    // ===== Init =====
    (function init(){
      state = migrate(state);
      buildDays();
      quickMeta.textContent = "Fechado";
      estimateMeta.textContent = "Fechado";
      hydrateEstimateInputs();
      render();
    })();
  </script>
</body>
</html>
