<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>Meta Semanal ‚Äî Almo√ßo Gr√°tis!</title>
  <style>
    :root{
      /* Dark theme */
      --bg:#06060a;
      --text:#f3f6ff;
      --muted:#a7b0c6;
      --line:rgba(255,255,255,.10);

      /* Accents */
      --primary:#4f8cff;
      --primary2:#a855f7;

      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;

      /* Category accents */
      --rep:#60a5fa;      /* reparos */
      --dev:#a78bfa;      /* aparelhos */
      --acc:#fbbf24;      /* acess√≥rios */

      --shadow: 0 16px 40px rgba(0,0,0,.55);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 500px at 12% 0%, rgba(79,140,255,.18), transparent 60%),
        radial-gradient(900px 500px at 92% 10%, rgba(168,85,247,.18), transparent 60%),
        var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 16px 14px 28px;
    }

    header{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin: 6px 0 14px;
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    h1{
      margin:0;
      font-size: 20px;
      letter-spacing:.2px;
      line-height:1.2;
      color: var(--text);
    }

    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
      white-space:nowrap;
      font-size:13px;
      color: var(--text);
    }

    .pill strong{ color: var(--text); font-weight: 950; }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 860px){
      .grid{
        grid-template-columns: 1.15fr .85fr;
        align-items:start;
      }
      h1{ font-size: 22px; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHeader{
      padding: 14px 14px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(79,140,255,.18), rgba(168,85,247,.10));
    }

    .cardHeader h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
      color: var(--text);
      font-weight: 950;
    }

    .cardHeader p{
      margin:6px 0 0;
      font-size:12px;
      color: rgba(243,246,255,.85);
      line-height:1.35;
    }

    .cardBody{ padding: 14px; }

    /* Top weekly summary */
    .topSummary{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      padding: 12px;
      margin-bottom: 12px;
    }
    .topSummaryHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .topSummaryHead .t1{
      font-weight: 950;
      letter-spacing:.2px;
    }
    .topSummaryGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .topSummaryGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .chip{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      padding: 10px;
      background: rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    .chip::before{
      content:"";
      position:absolute;
      inset:0;
      opacity:.18;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      pointer-events:none;
    }
    .chip.rep::before{ background: linear-gradient(90deg, var(--rep), rgba(96,165,250,.2)); opacity:.22; }
    .chip.dev::before{ background: linear-gradient(90deg, var(--dev), rgba(167,139,250,.2)); opacity:.22; }
    .chip.acc::before{ background: linear-gradient(90deg, var(--acc), rgba(251,191,36,.2)); opacity:.20; }
    .chip .k{ position:relative; margin:0; font-size:12px; color: var(--muted); }
    .chip .v{ position:relative; margin:6px 0 0; font-size:16px; font-weight: 950; color: var(--text); }
    .chip .s{ position:relative; margin:6px 0 0; font-size:12px; color: rgba(243,246,255,.85); }

    /* Progress */
    .progressTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-end;
      flex-wrap:wrap;
      margin-bottom:10px;
    }

    .big{
      font-size: 20px;
      font-weight: 950;
      letter-spacing: .2px;
      color: var(--text);
    }
    .small{
      font-size: 12px;
      color: var(--muted);
    }

    .bar{
      height: 14px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      overflow:hidden;
      position:relative;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    .bar > .fill{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      transition: width .35s ease;
    }

    .motivation{
      margin-top: 10px;
      padding: 12px 12px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      color: var(--text);
      line-height:1.35;
      font-size: 13px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }

    .badge{
      flex:0 0 auto;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-weight:950;
      color:#0b0f1c;
      background: rgba(255,255,255,.90);
    }
    .badge.good{ background: rgba(34,197,94,.95); color:#07110a; }
    .badge.warn{ background: rgba(245,158,11,.95); color:#120b03; }
    .badge.bad{ background: rgba(239,68,68,.95); color:#140606; }
    .badge.neutral{ background: rgba(79,140,255,.95); color:#050816; }

    /* Collapsible */
    details{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px;
      background: rgba(255,255,255,.04);
      user-select:none;
    }
    summary::-webkit-details-marker{ display:none; }
    .sumLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .chev{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      display:grid;
      place-items:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 950;
      flex: 0 0 auto;
    }
    details[open] .chev{ transform: rotate(90deg); }
    .sumTitle{
      font-weight: 950;
      color: var(--text);
      font-size: 13px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sumMeta{
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
      flex: 0 0 auto;
    }
    .panel{
      padding: 12px;
      display:grid;
      gap:10px;
    }

    /* Grids */
    .quickGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .quickGrid{ grid-template-columns: 1fr 1fr 1fr auto; }
    }

    .mixGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .mixGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .mixGrid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      align-items:end;
    }
    @media (min-width: 520px){
      .mixGrid2{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .inputs{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .inputs{ grid-template-columns: repeat(3, 1fr); }
    }

    label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size: 12px;
      color: var(--muted);
      min-width: 0;
    }

    input[type="number"]{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(5,8,22,.6);
      color: var(--text);
      outline:none;
      font-size: 14px;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    input[type="number"]:focus{
      border-color: rgba(79,140,255,.65);
      box-shadow: 0 0 0 4px rgba(79,140,255,.18);
    }

    .stats{
      display:grid;
      gap:10px;
    }

    .statGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .statGrid{ grid-template-columns: 1fr 1fr; }
    }

    .stat{
      padding: 12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .stat .k{
      margin:0;
      font-size:12px;
      color: var(--muted);
    }
    .stat .v{
      margin:6px 0 0;
      font-size:18px;
      font-weight: 950;
      letter-spacing: .2px;
      color: var(--text);
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--text);
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 950;
      font-size: 13px;
      letter-spacing: .2px;
      cursor:pointer;
      width:100%;
    }
    @media (min-width: 520px){
      button{ width:auto; }
    }
    button:active{ transform: translateY(1px); }
    .btnPrimary{
      border-color: rgba(79,140,255,.35);
      background: linear-gradient(180deg, rgba(79,140,255,.22), rgba(79,140,255,.10));
    }
    .btnDanger{
      border-color: rgba(239,68,68,.30);
      background: linear-gradient(180deg, rgba(239,68,68,.22), rgba(239,68,68,.10));
    }

    .footerNote{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.35;
    }

    .historyHead{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .historyHead .left{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .historyHead .left strong{ color: var(--text); }
    .historyList{
      display:grid;
      gap:10px;
    }
    .weekItem{
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      display:grid;
      gap:8px;
    }
    .weekTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .weekTop .wtitle{
      font-weight: 950;
      color: var(--text);
      letter-spacing:.2px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      font-size:12px;
      font-weight: 950;
      white-space:nowrap;
      background: rgba(255,255,255,.05);
    }
    .tag.good{ background: rgba(34,197,94,.14); color: #7CFFB1; border-color: rgba(34,197,94,.30); }
    .tag.bad{ background: rgba(239,68,68,.12); color: #FF9AA7; border-color: rgba(239,68,68,.28); }

    .weekGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
    }
    @media (min-width: 520px){
      .weekGrid{ grid-template-columns: 1fr 1fr 1fr; }
    }
    .mini{
      border:1px dashed rgba(255,255,255,.16);
      border-radius: 14px;
      padding: 10px;
      background: rgba(0,0,0,.20);
    }
    .mini .k{ margin:0; font-size:11px; color: var(--muted); }
    .mini .v{ margin:6px 0 0; font-size:14px; font-weight: 950; color: var(--text); }

    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      max-width: min(560px, calc(100% - 24px));
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,14,25,.88);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 50;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="titleRow">
        <div>
          <h1>Meta Semanal (Seg‚ÄìS√°b) ‚Äî Almo√ßo gr√°tis se bater! üçΩÔ∏èüî•</h1>
          <p class="subtitle">
            Agora com <strong>Resumo no topo</strong> + <strong>Estimativa do que vender</strong> para bater a meta. ‚úÖ
          </p>
        </div>
        <div class="pill" aria-label="Meta semanal">
          üéØ <span>Meta: <strong id="goalLabel">R$ 12.000,00</strong></span>
        </div>
      </div>
    </header>

    <section class="grid">
      <!-- Main -->
      <div class="card">
        <div class="cardHeader">
          <div>
            <h2>Semana atual</h2>
            <p>Progresso + lan√ßamentos (salva automaticamente no navegador). üìà</p>
          </div>
          <div class="pill">üìÖ <strong id="weekLabel">Semana</strong></div>
        </div>

        <div class="cardBody">
          <!-- RESUMO NO TOPO -->
          <div class="topSummary" aria-label="Resumo da semana no topo">
            <div class="topSummaryHead">
              <div>
                <div class="t1">üìå Resumo da semana (at√© agora)</div>
                <div class="subtitle" style="margin-top:4px;">Reparos üîß ‚Ä¢ Aparelhos üì± ‚Ä¢ Acess√≥rios üéß</div>
              </div>
              <div class="pill">‚ö° <span>Progresso: <strong id="topPct">0%</strong></span></div>
            </div>
            <div class="topSummaryGrid">
              <div class="chip rep">
                <p class="k">üîß Reparos</p>
                <p class="v" id="topRep">R$ 0,00</p>
                <p class="s" id="topRepS">‚Äî</p>
              </div>
              <div class="chip dev">
                <p class="k">üì± Aparelhos</p>
                <p class="v" id="topDev">R$ 0,00</p>
                <p class="s" id="topDevS">Lucro estimado/unidade: <strong id="topProfitUnit">R$ 400,00</strong></p>
              </div>
              <div class="chip acc">
                <p class="k">üéß Acess√≥rios</p>
                <p class="v" id="topAcc">R$ 0,00</p>
                <p class="s" id="topAccS">‚Äî</p>
              </div>
            </div>
          </div>

          <div class="progressTop">
            <div>
              <div class="big" id="totalLabel">R$ 0,00</div>
              <div class="small">
                <span id="pctLabel">0%</span> ‚Ä¢ Falta <span id="remainingLabel">R$ 12.000,00</span>
              </div>
            </div>
            <div class="pill">üèÜ Almo√ßo gr√°tis ao atingir <strong>100%</strong></div>
          </div>

          <div class="bar" aria-label="Barra de progresso">
            <div class="fill" id="barFill"></div>
          </div>

          <div class="motivation" role="status" aria-live="polite">
            <div class="badge neutral" id="motivationBadge">‚ö°</div>
            <div>
              <div style="font-weight:950; margin-bottom:4px;" id="motivationTitle">Vamo pra cima! üí•</div>
              <div id="motivationText">Hoje √© dia de executar sem desculpa: atendimento afiado, oferta na mesa e fechamento no caixa. O almo√ßo gr√°tis √© NOSSO! üçΩÔ∏èüî•</div>
            </div>
          </div>

          <div style="height:12px"></div>

          <!-- ESTIMATIVA (FECHADO por padr√£o) -->
          <details id="estimateDetails">
            <summary>
              <div class="sumLeft">
                <div class="chev">‚Ä∫</div>
                <div class="sumTitle">Estimativa: quanto vender para bater a meta üß†üìå</div>
              </div>
              <div class="sumMeta" id="estimateMeta">Fechado</div>
            </summary>

            <div class="panel">
              <div class="subtitle" style="margin:0;">
                Configure o ‚Äúpeso‚Äù (mix) de cada categoria na meta semanal. Por padr√£o: <strong>Reparos maior</strong>, <strong>Aparelhos segundo</strong> (lucro ~ R$ 400/un),
                <strong>Acess√≥rios menor</strong>. Ajuste como quiser. ‚úÖ
              </div>

              <div class="mixGrid">
                <label>
                  % Reparos (maior) üîß
                  <input id="mixRep" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 60" />
                </label>
                <label>
                  % Aparelhos (2¬∫ maior) üì±
                  <input id="mixDev" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 30" />
                </label>
                <label>
                  % Acess√≥rios (menor) üéß
                  <input id="mixAcc" type="number" inputmode="decimal" min="0" step="1" placeholder="Ex: 10" />
                </label>
              </div>

              <div class="mixGrid2">
                <label>
                  Ticket m√©dio por reparo (R$) üîß
                  <input id="avgRepair" type="number" inputmode="decimal" min="1" step="1" placeholder="Ex: 250" />
                </label>
                <label>
                  Lucro por aparelho (R$) üì±
                  <input id="profitDevice" type="number" inputmode="decimal" min="1" step="1" placeholder="400" />
                </label>
                <label>
                  Ticket m√©dio por acess√≥rio (R$) üéß
                  <input id="avgAccessory" type="number" inputmode="decimal" min="1" step="1" placeholder="Ex: 50" />
                </label>
              </div>

              <div class="topSummary" style="margin:0;">
                <div class="topSummaryHead" style="margin-bottom:8px;">
                  <div class="t1">üéØ Necess√°rio na semana (estimado)</div>
                  <div class="pill">Œ£ <strong id="mixTotalPct">100%</strong></div>
                </div>

                <div class="topSummaryGrid">
                  <div class="chip rep">
                    <p class="k">üîß Reparos</p>
                    <p class="v" id="needRepMoney">R$ 0,00</p>
                    <p class="s" id="needRepUnits">‚âà 0 reparos/semana</p>
                  </div>
                  <div class="chip dev">
                    <p class="k">üì± Aparelhos (lucro)</p>
                    <p class="v" id="needDevMoney">R$ 0,00</p>
                    <p class="s" id="needDevUnits">‚âà 0 aparelhos/semana</p>
                  </div>
                  <div class="chip acc">
                    <p class="k">üéß Acess√≥rios</p>
                    <p class="v" id="needAccMoney">R$ 0,00</p>
                    <p class="s" id="needAccUnits">‚âà 0 acess√≥rios/semana</p>
                  </div>
                </div>

                <div class="subtitle" style="margin-top:10px;">
                  üí° Dica: se o total das % n√£o der 100%, eu <strong>normalizo automaticamente</strong> (divido proporcionalmente).
                </div>
              </div>
            </div>
          </details>

          <div style="height:12px"></div>

          <!-- Entrada r√°pida (FECHADO por padr√£o) -->
          <details id="quickDetails">
            <summary>
              <div class="sumLeft">
                <div class="chev">‚Ä∫</div>
                <div class="sumTitle">Entrada r√°pida: lan√ßar TOTAL da semana por categoria üßæ</div>
              </div>
              <div class="sumMeta" id="quickMeta">Fechado</div>
            </summary>
            <div class="panel">
              <div class="subtitle" style="margin:0;">
                Se voc√™ s√≥ tem o total no √∫ltimo dia, preencha os 3 valores (um por categoria) e aplique.
                Isso vai preencher tudo no <strong>S√°bado</strong> (como ‚Äúfechamento‚Äù da semana). ‚úÖ
              </div>

              <div class="quickGrid">
                <label>
                  Consertos (R$) üîß
                  <input id="qConsertos" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <label>
                  Acess√≥rios (R$) üéß
                  <input id="qAcessorios" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <label>
                  Venda de Aparelhos (R$) üì±
                  <input id="qAparelhos" type="number" inputmode="decimal" min="0" step="0.01" placeholder="0,00" />
                </label>
                <button class="btnPrimary" id="applyQuickBtn">Aplicar üöÄ</button>
              </div>

              <div class="subtitle" style="margin:0;">
                Dica: quer lan√ßar um total √∫nico? Preencha s√≥ uma categoria e deixe as outras em 0. üéØ
              </div>
            </div>
          </details>

          <div style="height:12px"></div>

          <!-- Dias (todos FECHADOS por padr√£o) -->
          <div id="daysBox" style="display:grid; gap:10px;"></div>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="card">
        <div class="cardHeader">
          <div>
            <h2>Resumo & Hist√≥rico</h2>
            <p>Categoria, m√©dias e semanas anteriores. üóÇÔ∏è</p>
          </div>
        </div>

        <div class="cardBody">
          <div class="stats">
            <div class="statGrid">
              <div class="stat">
                <p class="k">Consertos üîß</p>
                <p class="v" id="sumConsertos">R$ 0,00</p>
              </div>
              <div class="stat">
                <p class="k">Acess√≥rios üéß</p>
                <p class="v" id="sumAcessorios">R$ 0,00</p>
              </div>
              <div class="stat" style="grid-column: 1 / -1;">
                <p class="k">Venda de Aparelhos üì±</p>
                <p class="v" id="sumAparelhos">R$ 0,00</p>
              </div>
            </div>

            <div class="stat">
              <p class="k">M√©dia por dia (dias preenchidos) üìä</p>
              <p class="v" id="avgPerDay">R$ 0,00</p>
              <p class="k" style="margin-top:8px;">Ritmo necess√°rio (m√©dia/dia para bater) ‚è±Ô∏è</p>
              <p class="v" id="neededPerDay">R$ 0,00</p>
            </div>

            <div class="actions">
              <button class="btnPrimary" id="closeWeekBtn">Fechar semana e salvar no hist√≥rico üèÅ</button>
              <button class="btnDanger" id="resetBtn">Zerar semana atual üß®</button>
            </div>

            <div class="historyHead">
              <div class="left">
                <strong>Hist√≥rico</strong>
                <span class="subtitle" style="margin:0;">Semanas fechadas (Semana 1, 2, 3...)</span>
              </div>
              <button class="btnDanger" id="clearHistoryBtn" style="width:auto;">Limpar hist√≥rico üóëÔ∏è</button>
            </div>

            <div class="historyList" id="historyList"></div>

            <p class="footerNote">
              ‚úÖ Tudo fica salvo neste navegador (sem servidor). <br/>
              üìå ‚ÄúFechar semana‚Äù salva a Semana atual no hist√≥rico e inicia uma nova semana em branco.
            </p>
          </div>
        </div>
      </aside>
    </section>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Config =====
    const GOAL = 12000;

    const DAYS = [
      { key: "seg", label: "Segunda" },
      { key: "ter", label: "Ter√ßa" },
      { key: "qua", label: "Quarta" },
      { key: "qui", label: "Quinta" },
      { key: "sex", label: "Sexta" },
      { key: "sab", label: "S√°bado" },
    ];

    const CATS = [
      { key: "consertos", label: "Consertos" },
      { key: "acessorios", label: "Acess√≥rios" },
      { key: "aparelhos", label: "Venda de aparelhos" },
    ];

    const STORAGE_KEY = "meta_semanal_v5_dark_estimate"; // atualizado

    // ===== Helpers =====
    const brl = (n) =>
      new Intl.NumberFormat("pt-BR", { style: "currency", currency: "BRL" }).format(n || 0);

    function clamp(n, min, max){ return Math.min(Math.max(n, min), max); }

    function getWeekLabel(){
      const now = new Date();
      const dd = String(now.getDate()).padStart(2,"0");
      const mm = String(now.getMonth()+1).padStart(2,"0");
      return `Semana de ${dd}/${mm}`;
    }

    function safeNumber(v){
      const n = Number(v);
      return Number.isFinite(n) ? Math.max(0, n) : 0;
    }

    function safePositive(v, fallback){
      const n = Number(v);
      return Number.isFinite(n) && n > 0 ? n : fallback;
    }

    function showToast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(()=> el.classList.remove("show"), 2200);
    }

    function sumWeekData(data){
      let total = 0;
      const perCat = { consertos:0, acessorios:0, aparelhos:0 };
      const perDay = {};

      for (const d of DAYS){
        let dayTotal = 0;
        for (const c of CATS){
          const v = safeNumber(data?.[d.key]?.[c.key] ?? 0);
          dayTotal += v;
          perCat[c.key] += v;
        }
        perDay[d.key] = dayTotal;
        total += dayTotal;
      }
      return { total, perCat, perDay };
    }

    // ===== State =====
    function blankWeekData(){
      const data = {};
      for (const d of DAYS){
        data[d.key] = {};
        for (const c of CATS) data[d.key][c.key] = 0;
      }
      return data;
    }

    function defaultState(){
      return {
        weekNumber: 1,
        current: { data: blankWeekData() },
        history: [],
        estimate: {
          // mix default (reparos maior, aparelhos 2¬∫, acess√≥rios menor)
          mixRep: 60,
          mixDev: 30,
          mixAcc: 10,
          avgRepair: 250,     // ticket m√©dio por reparo (ajust√°vel)
          profitDevice: 400,  // lucro por aparelho (pedido)
          avgAccessory: 50    // ticket m√©dio acess√≥rio (ajust√°vel)
        }
      };
    }

    function migrate(obj){
      const base = defaultState();
      if(!obj || typeof obj !== "object") return base;

      // j√° v5
      if(obj.current && obj.history && obj.weekNumber){
        obj.estimate = obj.estimate || base.estimate;
        obj.estimate.mixRep = safeNumber(obj.estimate.mixRep ?? base.estimate.mixRep);
        obj.estimate.mixDev = safeNumber(obj.estimate.mixDev ?? base.estimate.mixDev);
        obj.estimate.mixAcc = safeNumber(obj.estimate.mixAcc ?? base.estimate.mixAcc);
        obj.estimate.avgRepair = safeNumber(obj.estimate.avgRepair ?? base.estimate.avgRepair);
        obj.estimate.profitDevice = safeNumber(obj.estimate.profitDevice ?? base.estimate.profitDevice);
        obj.estimate.avgAccessory = safeNumber(obj.estimate.avgAccessory ?? base.estimate.avgAccessory);
        return obj;
      }

      // aproveita algo antigo
      if(obj.data){
        base.current.data = blankWeekData();
        for (const d of DAYS){
          for (const c of CATS){
            base.current.data[d.key][c.key] = safeNumber(obj.data?.[d.key]?.[c.key] ?? 0);
          }
        }
      }
      return base;
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        return migrate(JSON.parse(raw));
      }catch{
        return defaultState();
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    // ===== Motivation (impacto + emojis) =====
    function motivationFor(pct, remaining){
      const m = {
        badgeClass: "neutral",
        badge: "‚ö°",
        title: "Vamo pra cima! üí•",
        text: "Hoje √© dia de executar sem desculpa: atendimento afiado, oferta na mesa e fechamento no caixa. O almo√ßo gr√°tis √© NOSSO! üçΩÔ∏èüî•"
      };

      if (pct >= 100){
        m.badgeClass = "good";
        m.badge = "üèÜ";
        m.title = "META BATIDA!!! √â CAMPE√ÉO! üéâüçΩÔ∏è";
        m.text = "TIME BRABO! Foi na ra√ßa e na consist√™ncia. Agora √© comemorar: almo√ßo gr√°tis garantido! üöÄüî•ü•≥";
        return m;
      }
      if (pct >= 90){
        m.badgeClass = "good";
        m.badge = "üö®";
        m.title = "FALTAM MIGALHAS! √öLTIMO ATAQUE! üöÄ";
        m.text = `Falta s√≥ ${brl(remaining)}. Sem freio agora: puxa oferta, fecha combo e garante a vit√≥ria! ü•äüî•`;
        return m;
      }
      if (pct >= 75){
        m.badgeClass = "neutral";
        m.badge = "üöÄ";
        m.title = "RETA FINAL ‚Äî MANT√âM A PRESS√ÉO! üí™";
        m.text = `J√° estamos em 75%+. Falta ${brl(remaining)}. N√£o tira o p√©: const√¢ncia + fechamento = almo√ßo na mesa! üçΩÔ∏è‚ö°`;
        return m;
      }
      if (pct >= 50){
        m.badgeClass = "neutral";
        m.badge = "üí•";
        m.title = "META NO RADAR ‚Äî AGORA ACELERA! üèéÔ∏è";
        m.text = `Metade feita! Falta ${brl(remaining)}. Bora subir ticket m√©dio e fechar sem deixar cliente ‚Äúpra depois‚Äù! üî•üìà`;
        return m;
      }
      if (pct >= 25){
        m.badgeClass = "neutral";
        m.badge = "‚úÖ";
        m.title = "COME√áO FORTE ‚Äî CONTINUA NO RITMO! üéØ";
        m.text = `25%+ j√° foi! Falta ${brl(remaining)}. Um dia bom puxa o outro ‚Äî vamos empilhar resultado! üß±üî•`;
        return m;
      }
      if (pct > 0){
        m.badgeClass = "neutral";
        m.badge = "üß†";
        m.title = "RITMO √â TUDO ‚Äî COME√áA AGORA! ‚è±Ô∏è";
        m.text = `Primeiros passos feitos. Falta ${brl(remaining)}. Foco no pr√≥ximo cliente e no pr√≥ximo fechamento! üí™‚ú®`;
      }
      return m;
    }

    // ===== UI build (Days) =====
    const daysBox = document.getElementById("daysBox");

    function buildDays(){
      daysBox.innerHTML = "";

      for (const d of DAYS){
        const det = document.createElement("details");
        det.id = `day_${d.key}`;

        const sum = document.createElement("summary");
        sum.innerHTML = `
          <div class="sumLeft">
            <div class="chev">‚Ä∫</div>
            <div class="sumTitle">${d.label} üìå</div>
          </div>
          <div class="sumMeta" id="meta_${d.key}">Total: ${brl(0)}</div>
        `;

        const panel = document.createElement("div");
        panel.className = "panel";

        const inputs = document.createElement("div");
        inputs.className = "inputs";

        for (const c of CATS){
          const lab = document.createElement("label");
          const emoji = c.key === "consertos" ? "üîß" : (c.key === "acessorios" ? "üéß" : "üì±");
          lab.textContent = `${c.label} ${emoji}`;

          const inp = document.createElement("input");
          inp.type = "number";
          inp.inputMode = "decimal";
          inp.min = "0";
          inp.step = "0.01";
          inp.placeholder = "0,00";
          inp.value = String(state.current.data[d.key][c.key] ?? 0);

          inp.addEventListener("input", () => {
            state.current.data[d.key][c.key] = safeNumber(inp.value);
            saveState();
            render();
          });

          lab.appendChild(inp);
          inputs.appendChild(lab);
        }

        panel.appendChild(inputs);
        det.appendChild(sum);
        det.appendChild(panel);
        daysBox.appendChild(det);
      }
    }

    function syncDayInputs(){
      for (const d of DAYS){
        const det = document.getElementById(`day_${d.key}`);
        if(!det) continue;
        const inputs = det.querySelectorAll('input[type="number"]');
        inputs.forEach((inp, idx)=>{
          const catKey = CATS[idx]?.key;
          if(!catKey) return;
          inp.value = String(safeNumber(state.current.data[d.key][catKey]));
        });
      }
    }

    // ===== Details meta labels =====
    const quickDetails = document.getElementById("quickDetails");
    const quickMeta = document.getElementById("quickMeta");
    quickDetails.addEventListener("toggle", () => {
      quickMeta.textContent = quickDetails.open ? "Aberto" : "Fechado";
    });

    const estimateDetails = document.getElementById("estimateDetails");
    const estimateMeta = document.getElementById("estimateMeta");
    estimateDetails.addEventListener("toggle", () => {
      estimateMeta.textContent = estimateDetails.open ? "Aberto" : "Fechado";
    });

    // ===== Quick Entry action =====
    document.getElementById("applyQuickBtn").addEventListener("click", () => {
      const vC = safeNumber(document.getElementById("qConsertos").value);
      const vA = safeNumber(document.getElementById("qAcessorios").value);
      const vP = safeNumber(document.getElementById("qAparelhos").value);
      const total = vC + vA + vP;

      if(total <= 0){
        showToast("Preencha pelo menos uma categoria. ‚ö†Ô∏è");
        return;
      }

      state.current.data = blankWeekData();

      const targetDay = "sab";
      state.current.data[targetDay].consertos = vC;
      state.current.data[targetDay].acessorios = vA;
      state.current.data[targetDay].aparelhos  = vP;

      saveState();
      syncDayInputs();
      render();
      showToast("Totais aplicados na semana ‚úÖüöÄ");
    });

    // ===== Estimativa inputs (persist) =====
    const mixRepEl = document.getElementById("mixRep");
    const mixDevEl = document.getElementById("mixDev");
    const mixAccEl = document.getElementById("mixAcc");
    const avgRepairEl = document.getElementById("avgRepair");
    const profitDeviceEl = document.getElementById("profitDevice");
    const avgAccessoryEl = document.getElementById("avgAccessory");

    function hydrateEstimateInputs(){
      mixRepEl.value = String(state.estimate.mixRep ?? 60);
      mixDevEl.value = String(state.estimate.mixDev ?? 30);
      mixAccEl.value = String(state.estimate.mixAcc ?? 10);
      avgRepairEl.value = String(state.estimate.avgRepair ?? 250);
      profitDeviceEl.value = String(state.estimate.profitDevice ?? 400);
      avgAccessoryEl.value = String(state.estimate.avgAccessory ?? 50);

      document.getElementById("topProfitUnit").textContent = brl(safePositive(state.estimate.profitDevice, 400));
    }

    function saveEstimateFromInputs(){
      state.estimate.mixRep = safeNumber(mixRepEl.value);
      state.estimate.mixDev = safeNumber(mixDevEl.value);
      state.estimate.mixAcc = safeNumber(mixAccEl.value);
      state.estimate.avgRepair = safeNumber(avgRepairEl.value);
      state.estimate.profitDevice = safeNumber(profitDeviceEl.value);
      state.estimate.avgAccessory = safeNumber(avgAccessoryEl.value);
      saveState();
      renderEstimate();
      renderTopSummary(); // atualiza lucro/unidade no topo
    }

    [mixRepEl, mixDevEl, mixAccEl, avgRepairEl, profitDeviceEl, avgAccessoryEl].forEach(el=>{
      el.addEventListener("input", saveEstimateFromInputs);
    });

    function normalizedMix(){
      let r = safeNumber(state.estimate.mixRep);
      let d = safeNumber(state.estimate.mixDev);
      let a = safeNumber(state.estimate.mixAcc);
      const sum = r + d + a;

      if(sum <= 0){
        r = 60; d = 30; a = 10;
        return { r, d, a, sum: 100 };
      }
      // normaliza p/ 100
      const rr = (r / sum) * 100;
      const dd = (d / sum) * 100;
      const aa = 100 - rr - dd; // ajusta centavos
      return { r: rr, d: dd, a: aa, sum: 100 };
    }

    function renderEstimate(){
      const mix = normalizedMix();
      document.getElementById("mixTotalPct").textContent = "100%";

      const avgRepair = safePositive(state.estimate.avgRepair, 250);
      const profitDevice = safePositive(state.estimate.profitDevice, 400);
      const avgAccessory = safePositive(state.estimate.avgAccessory, 50);

      const needRepMoney = GOAL * (mix.r/100);
      const needDevMoney = GOAL * (mix.d/100);
      const needAccMoney = GOAL * (mix.a/100);

      const repUnits = Math.ceil(needRepMoney / avgRepair);
      const devUnits = Math.ceil(needDevMoney / profitDevice); // lucro/unidade (pedido)
      const accUnits = Math.ceil(needAccMoney / avgAccessory);

      document.getElementById("needRepMoney").textContent = brl(needRepMoney);
      document.getElementById("needDevMoney").textContent = brl(needDevMoney);
      document.getElementById("needAccMoney").textContent = brl(needAccMoney);

      document.getElementById("needRepUnits").textContent = `‚âà ${repUnits} reparos/semana (ticket ~ ${brl(avgRepair)})`;
      document.getElementById("needDevUnits").textContent = `‚âà ${devUnits} aparelhos/semana (lucro ~ ${brl(profitDevice)}/un)`;
      document.getElementById("needAccUnits").textContent = `‚âà ${accUnits} acess√≥rios/semana (ticket ~ ${brl(avgAccessory)})`;

      // atualiza lucro no topo
      document.getElementById("topProfitUnit").textContent = brl(profitDevice);
    }

    // ===== History render =====
    function renderHistory(){
      const box = document.getElementById("historyList");
      box.innerHTML = "";

      if (!state.history.length){
        const empty = document.createElement("div");
        empty.className = "weekItem";
        empty.innerHTML = `
          <div class="weekTop">
            <div class="wtitle">Nenhuma semana fechada ainda üóÇÔ∏è</div>
            <span class="tag bad">Hist√≥rico vazio</span>
          </div>
          <div style="color: var(--muted); font-size: 12px; line-height:1.35;">
            Feche a semana para salvar no hist√≥rico como Semana 1, Semana 2, etc. ‚úÖ
          </div>
        `;
        box.appendChild(empty);
        return;
      }

      const items = [...state.history].sort((a,b)=> b.weekNumber - a.weekNumber);

      for (const item of items){
        const pct = clamp((item.total / item.goal) * 100, 0, 999);
        const hit = item.total >= item.goal;

        const el = document.createElement("div");
        el.className = "weekItem";

        const date = item.closedAt ? new Date(item.closedAt) : null;
        const dateLabel = date ? date.toLocaleString("pt-BR") : "-";

        el.innerHTML = `
          <div class="weekTop">
            <div>
              <div class="wtitle">Semana ${item.weekNumber}</div>
              <div style="color: var(--muted); font-size: 12px; margin-top:2px;">
                Fechada em: ${dateLabel}
              </div>
            </div>
            <span class="tag ${hit ? "good" : "bad"}">
              ${hit ? "Meta batida ‚úÖ" : "N√£o bateu ‚ùå"} ‚Ä¢ ${Math.floor(pct)}%
            </span>
          </div>

          <div class="weekGrid">
            <div class="mini">
              <p class="k">Total</p>
              <p class="v">${brl(item.total)}</p>
            </div>
            <div class="mini">
              <p class="k">Meta</p>
              <p class="v">${brl(item.goal)}</p>
            </div>
            <div class="mini">
              <p class="k">Faltou / Sobrou</p>
              <p class="v">${hit ? brl(item.total - item.goal) : brl(item.goal - item.total)}</p>
            </div>
            <div class="mini">
              <p class="k">Consertos üîß</p>
              <p class="v">${brl(item.perCat.consertos)}</p>
            </div>
            <div class="mini">
              <p class="k">Acess√≥rios üéß</p>
              <p class="v">${brl(item.perCat.acessorios)}</p>
            </div>
            <div class="mini">
              <p class="k">Aparelhos üì±</p>
              <p class="v">${brl(item.perCat.aparelhos)}</p>
            </div>
          </div>
        `;
        box.appendChild(el);
      }
    }

    // ===== Resumo no topo (parte superior) =====
    function renderTopSummary(){
      const { total, perCat } = sumWeekData(state.current.data);
      const pct = clamp((total / GOAL) * 100, 0, 999);

      document.getElementById("topPct").textContent = `${Math.floor(pct)}%`;
      document.getElementById("topRep").textContent = brl(perCat.consertos);
      document.getElementById("topDev").textContent = brl(perCat.aparelhos);
      document.getElementById("topAcc").textContent = brl(perCat.acessorios);

      const remaining = Math.max(0, GOAL - total);
      document.getElementById("topRepS").textContent = `üéØ Ajuda na meta: foco no ticket m√©dio`;
      document.getElementById("topAccS").textContent = `‚ö° Upsell no balc√£o: ‚Äúj√° leva junto?‚Äù`;

      const profitDevice = safePositive(state.estimate.profitDevice, 400);
      document.getElementById("topProfitUnit").textContent = brl(profitDevice);
      document.getElementById("topDevS").innerHTML = `Lucro estimado/unidade: <strong>${brl(profitDevice)}</strong>`;

      // Se quiser, mostra o ‚Äúfaltam X aparelhos‚Äù s√≥ pelo lucro (extra √∫til)
      const approxDevicesToGoal = Math.ceil(remaining / profitDevice);
      if (remaining > 0) {
        document.getElementById("topDevS").innerHTML =
          `Lucro/un: <strong>${brl(profitDevice)}</strong> ‚Ä¢ Para cobrir o restante s√≥ com aparelhos: <strong>~${approxDevicesToGoal}</strong> üì±`;
      } else {
        document.getElementById("topDevS").innerHTML =
          `Lucro/un: <strong>${brl(profitDevice)}</strong> ‚Ä¢ Meta batida! üèÜ`;
      }
    }

    // ===== Render geral =====
    function render(){
      const { total, perCat, perDay } = sumWeekData(state.current.data);
      const pct = clamp((total / GOAL) * 100, 0, 999);
      const pctShown = Math.floor(pct);
      const remaining = Math.max(0, GOAL - total);

      document.getElementById("totalLabel").textContent = brl(total);
      document.getElementById("pctLabel").textContent = `${pctShown}%`;
      document.getElementById("remainingLabel").textContent = brl(remaining);
      document.getElementById("barFill").style.width = `${clamp(pct, 0, 100)}%`;

      document.getElementById("sumConsertos").textContent = brl(perCat.consertos);
      document.getElementById("sumAcessorios").textContent = brl(perCat.acessorios);
      document.getElementById("sumAparelhos").textContent = brl(perCat.aparelhos);

      const daysWithAny = DAYS.reduce((acc,d)=> acc + (perDay[d.key] > 0 ? 1 : 0), 0);
      const avg = daysWithAny > 0 ? total / daysWithAny : 0;
      document.getElementById("avgPerDay").textContent = brl(avg);

      const daysRemaining = Math.max(0, DAYS.length - daysWithAny);
      const needed = daysRemaining > 0 ? remaining / daysRemaining : remaining;
      document.getElementById("neededPerDay").textContent = brl(needed);

      for (const d of DAYS){
        const meta = document.getElementById(`meta_${d.key}`);
        if(meta) meta.textContent = "Total: " + brl(perDay[d.key]);
      }

      const mot = motivationFor(pct, remaining);
      const badge = document.getElementById("motivationBadge");
      badge.className = `badge ${mot.badgeClass}`;
      badge.textContent = mot.badge;
      document.getElementById("motivationTitle").textContent = mot.title;
      document.getElementById("motivationText").textContent = mot.text;

      document.getElementById("weekLabel").textContent = getWeekLabel() + ` ‚Ä¢ Semana ${state.weekNumber}`;
      document.getElementById("goalLabel").textContent = brl(GOAL);

      renderTopSummary();
      renderEstimate();
      renderHistory();
    }

    // ===== Actions =====
    document.getElementById("resetBtn").addEventListener("click", () => {
      state.current.data = blankWeekData();
      saveState();
      syncDayInputs();
      render();
      showToast("Semana atual zerada ‚úÖ");
    });

    document.getElementById("closeWeekBtn").addEventListener("click", () => {
      const { total, perCat } = sumWeekData(state.current.data);

      state.history.push({
        weekNumber: state.weekNumber,
        closedAt: new Date().toISOString(),
        goal: GOAL,
        total,
        perCat
      });

      state.weekNumber += 1;
      state.current.data = blankWeekData();

      document.getElementById("qConsertos").value = "";
      document.getElementById("qAcessorios").value = "";
      document.getElementById("qAparelhos").value = "";

      saveState();
      syncDayInputs();
      render();

      showToast(total >= GOAL ? "META BATIDA! Semana salva üèÜüî•" : "Semana salva ‚Äî volta mais forte! üí™‚ö°");
    });

    document.getElementById("clearHistoryBtn").addEventListener("click", () => {
      state.history = [];
      saveState();
      render();
      showToast("Hist√≥rico limpo ‚úÖüóëÔ∏è");
    });

    // ===== Init =====
    (function init(){
      state = migrate(state);

      state.current = state.current || { data: blankWeekData() };
      state.current.data = state.current.data || blankWeekData();
      for (const d of DAYS){
        state.current.data[d.key] = state.current.data[d.key] || {};
        for (const c of CATS){
          state.current.data[d.key][c.key] = safeNumber(state.current.data?.[d.key]?.[c.key] ?? 0);
        }
      }

      buildDays();

      // details labels
      quickMeta.textContent = "Fechado";
      estimateMeta.textContent = "Fechado";

      // estimate inputs
      hydrateEstimateInputs();

      render();
    })();
  </script>
</body>
</html>
